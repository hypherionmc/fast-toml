"use strict";let e="",i=0;function n(e,t=0){let i;for(;(i=e[t++])&&(" "==i||"\t"==i||"\r"==i););return t-1}function r(e){switch(e[0]){case void 0:return"";case'"':return function(e){let t,i=0,n="";for(;t=e.indexOf("\\",i)+1;){switch(n+=e.slice(i,t-1),e[t]){case"\\":n+="\\";break;case'"':n+='"';break;case"\r":"\n"==e[t+1]&&t++;case"\n":break;case"b":n+="\b";break;case"t":n+="\t";break;case"n":n+="\n";break;case"f":n+="\f";break;case"r":n+="\r";break;case"u":n+=String.fromCharCode(parseInt(e.substr(t+1,4),16)),t+=4;break;case"U":n+=String.fromCharCode(parseInt(e.substr(t+1,8),16)),t+=8;break;default:throw s(e[t])}i=t+1}return n+e.slice(i)}(e.slice(1,-1));case"'":return e.slice(1,-1);case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":case".":let i=e;if("string"==typeof t&&t.length>16)return t;if(-1!=i.indexOf("_")&&(i=i.replace(/_/g,"")),!isNaN(i))return+i;if("-"==e[4]&&"-"==e[7]){let t=new Date(e);if("Invalid Date"!=t.toString())return t}else if(":"==e[2]&&":"==e[5]&&e.length>=7){let t=new Date("0000-01-01T"+e+"Z");if("Invalid Date"!=t.toString())return t}return e}switch(e){case"true":return!0;case"false":return!1;case"nan":case"NaN":return!1;case"null":return null;case"inf":case"+inf":case"Infinity":case"+Infinity":return 1/0;case"-inf":case"-Infinity":return-1/0}return e}function s(t){let n=function(){let t=e[i],n=i;"\n"==t&&n--;let r=1,s=e.lastIndexOf("\n",n),a=e.indexOf("\n",n);-1==a&&(a=1/0);","!=t&&"\n"!=t||(n=s+1);if(-1==s)return{line:r,column:n+1,position:n,lineContent:e.slice(0,a).trim()};const c=n-s+1,o=e.slice(s+1,a).trim();r++;for(;-1!=(s=e.lastIndexOf("\n",s-1));)r++;return{line:r,column:c,position:n,lineContent:o}}(),r=String(n.line);return t+="\n"+r+" |  "+n.lineContent+"\n",t+=" ".repeat(r.length+n.column+2)+"^",SyntaxError(t)}function a(e,t=0,n=!1){let r,c=e[t],o=c,f=c,l=!0,u=!1;switch(c){case'"':case"'":if(r=t+1,n&&e[t+1]==c&&e[t+2]==c?(f=c+c+c,r+=2):u=!0,"'"==c)r=e.indexOf(f,r)+1;else for(;r=e.indexOf(f,r)+1;){let t=!0,i=r-1;for(;"\\"==e[--i];)t=!t;if(t)break}if(!r)throw s("Missing "+f+" closer");if(c!=f)r+=2;else if(u){let n=e.indexOf("\n",t+1)+1;if(n&&n<r)throw i=n-2,s("Forbidden end-of-line character in single-line string")}return r;case"(":f=")";break;case"{":f="}";break;case"[":f="]";break;case"<":f=">";break;default:l=!1}let h=0;for(;c=e[++t];)if(c==f){if(0==h)return t+1;h--}else if('"'==c||"'"==c){t=a(e,t,n)-1}else l&&c==o&&h++;throw s("Missing "+f)}function c(e){"string"!=typeof e&&(e=String(e));let t,i,n=-1,r="",c=[];for(;i=e[++n];)switch(i){case".":if(!r)throw s('Unexpected "."');c.push(r),r="";continue;case'"':case"'":if(t=a(e,n),t==n+2)throw s("Empty string key");r+=e.slice(n+1,t-1),n=t-1;continue;default:r+=i}return r&&c.push(r),c}function o(e,t=[]){const i=t.pop();for(let i of t){if("object"!=typeof e){throw s('["'+t.slice(0,t.indexOf(i)+1).join('"].["')+'"]'+" must be an object")}void 0===e[i]&&(e[i]={}),(e=e[i])instanceof Array&&(e=e[e.length-1])}return[e,i]}class f{constructor(){this.root={},this.data=this.root,this.inlineScopeList=[]}get isRoot(){return this.data==this.root}set(e,t){let[i,n]=o(this.data,c(e));if("string"==typeof i)throw"Wtf the scope is a string. Please report the bug";if(n in i)throw s(`Re-writing the key '${e}'`);return i[n]=t,t}push(e){if(!(this.data instanceof Array)){if(!this.isRoot)throw s("Missing key");this.data=Object.assign([],this.data),this.root=this.data}return this.data.push(e),this}use(e){return this.data=function(e,t=[]){for(let i of t){if(void 0===e)e=lastData[lastElt]={};else if("object"!=typeof e)throw s('["'+t.slice(0,t.indexOf(i)+1).join('"].["')+'"] must be an object');void 0===e[i]&&(e[i]={}),(e=e[i])instanceof Array&&(e=e[e.length-1])}return e}(this.root,c(e)),this}useArray(e){let[t,i]=o(this.root,c(e));return this.data={},void 0===t[i]&&(t[i]=[]),t[i].push(this.data),this}enter(e,t){return this.inlineScopeList.push(this.data),this.set(e,t),this.data=t,this}enterArray(e){return this.inlineScopeList.push(this.data),this.push(e),this.data=e,this}exit(){return this.data=this.inlineScopeList.pop(),this}}function l(t){"string"!=typeof t&&(t=String(t));const c=new f,o=[];e=t,i=0;let l,u,h="",d="",p=e[0],w=!0;const g=()=>{if(h=h.trimEnd(),w)h&&c.push(r(h));else{if(!h)throw s("Expected key before =");if(!d)throw s("Expected value after =");c.set(h,r(d.trimEnd()))}h="",d="",w=!0};do{switch(p){case" ":w?h&&(h+=p):d&&(d+=p);case"\t":case"\r":continue;case"#":i=e.indexOf("\n",i+1)-1,-2==i&&(i=1/0);continue;case'"':case"'":if(!w&&d){d+=p;continue}let t=e[i+1]==p&&e[i+2]==p;if(l=a(e,i,!0),w){if(h)throw s("Unexpected "+p);h+=t?e.slice(i+2,l-2):e.slice(i,l),i=l}else d=e.slice(i,l),i=l,t&&(d=d.slice(2,-2),"\n"==d[1]?d=d[0]+d.slice(2):"\r"==d[1]&&"\n"==d[2]&&(d=d[0]+d.slice(3)));if(i=n(e,i),p=e[i],p&&","!=p&&"\n"!=p&&"#"!=p&&"}"!=p&&"]"!=p&&"="!=p)throw s("Unexpected character after end of string");i--;continue;case"\n":case",":case void 0:g();continue;case"[":case"{":if(u="["==p?"]":"}",w&&!o.length){if(h)throw s("Unexpected "+p);if(l=a(e,i),"["==p&&"["==e[i+1]){if("]"!=e[l-2])throw s("Missing ]]");c.useArray(e.slice(i+2,l-2))}else c.use(e.slice(i+1,l-1));i=l}else if(w){if(h)throw s("Unexpected "+p);c.enterArray("["==p?[]:{}),o.push(u)}else{if(d)throw s("Unexpected "+p);c.enter(h.trimEnd(),"["==p?[]:{}),o.push(u),h="",w=!0}continue;case"]":case"}":if(h&&g(),o.pop()!=p)throw s("Unexpected "+p);if(c.exit(),i=n(e,i+1),p=e[i],p&&","!=p&&"\n"!=p&&"#"!=p&&"}"!=p&&"]"!=p)throw s("Unexpected character after end of scope");i--;continue;case"=":if(!w)throw s("Unexpected "+p);if(!h)throw s("Missing key before "+p);w=!1;continue;default:w?h+=p:d+=p}}while((p=e[++i])||h);if(o.length)throw s("Missing "+o.pop());return c.root}let u=null,h=null;function d(){let e="";for(let t of arguments)e+="string"==typeof t?t:t[0];return l(e)}d.parse=l,d.parseFile=async function(e){if(u||(u=require("fs")),!h){const{promisify:e}=require("util");h=e(u.readFile)}return l(await h(e))},d.parseFileSync=function(e){return u||(u=require("fs")),l(u.readFileSync(e))},module.exports=d;
